// Seed Data for KPI Management System
// Generated by Database Engineer Agent

import 'dotenv/config'
import { PrismaClient } from '@prisma/client'

// Ensure DATABASE_URL is set (use default SQLite path if not set)
if (!process.env.DATABASE_URL) {
  process.env.DATABASE_URL = 'file:./dev.db'
}

const prisma = new PrismaClient()

async function main() {
  console.log('ðŸŒ± Seeding database...')

  // Clean existing data
  await prisma.dashboardItem.deleteMany()
  await prisma.dashboard.deleteMany()
  await prisma.dataPoint.deleteMany()
  await prisma.kPI.deleteMany()
  await prisma.businessLine.deleteMany()

  // Create Business Lines
  const outsource = await prisma.businessLine.create({
    data: {
      name: 'ì™¸ì£¼',
      description: 'ì•„ì›ƒì†Œì‹± ì„œë¹„ìŠ¤',
      color: '#3B82F6', // blue
    },
  })

  const b2b = await prisma.businessLine.create({
    data: {
      name: 'B2B',
      description: 'ì»¨ì„¤íŒ… ê¸°ì—… ëŒ€ìƒ',
      color: '#10B981', // green
    },
  })

  const anyon = await prisma.businessLine.create({
    data: {
      name: 'ANYON',
      description: 'B2C í”„ë¡œë•íŠ¸',
      color: '#8B5CF6', // purple
    },
  })

  console.log('âœ… Business Lines created')

  // Create KPIs for ì™¸ì£¼
  const outsourceRevenue = await prisma.kPI.create({
    data: {
      name: 'ì›” ë§¤ì¶œ',
      description: 'ì™¸ì£¼ ì›”ê°„ ë§¤ì¶œ',
      unit: 'ë§Œì›',
      targetValue: 1000,
      currentValue: 750,
      measurementType: 'MONTHLY',
      category: 'ë§¤ì¶œ',
      businessLineId: outsource.id,
    },
  })

  const outsourceLeads = await prisma.kPI.create({
    data: {
      name: 'ì‹ ê·œ ë¦¬ë“œ',
      description: 'ì›”ê°„ ì‹ ê·œ ë¬¸ì˜ ìˆ˜',
      unit: 'ëª…',
      targetValue: 50,
      currentValue: 38,
      measurementType: 'MONTHLY',
      category: 'ë§ˆì¼€íŒ…',
      businessLineId: outsource.id,
    },
  })

  const outsourceConversion = await prisma.kPI.create({
    data: {
      name: 'ì „í™˜ìœ¨',
      description: 'ë¦¬ë“œ â†’ ê±°ëž˜ ì „í™˜ìœ¨',
      unit: '%',
      targetValue: 20,
      currentValue: 15.5,
      measurementType: 'MONTHLY',
      category: 'ì˜ì—…',
      businessLineId: outsource.id,
    },
  })

  // Create KPIs for B2B
  const b2bRevenue = await prisma.kPI.create({
    data: {
      name: 'ì›” ë§¤ì¶œ',
      description: 'B2B ì›”ê°„ ë§¤ì¶œ',
      unit: 'ë§Œì›',
      targetValue: 1500,
      currentValue: 1200,
      measurementType: 'MONTHLY',
      category: 'ë§¤ì¶œ',
      businessLineId: b2b.id,
    },
  })

  const b2bActiveClients = await prisma.kPI.create({
    data: {
      name: 'í™œì„± ê³ ê°ì‚¬',
      description: 'í˜„ìž¬ ê³„ì•½ ì¤‘ì¸ ê³ ê°ì‚¬ ìˆ˜',
      unit: 'ê°œì‚¬',
      targetValue: 10,
      currentValue: 8,
      measurementType: 'REALTIME',
      category: 'ì˜ì—…',
      businessLineId: b2b.id,
    },
  })

  // Create KPIs for ANYON
  const anyonMRR = await prisma.kPI.create({
    data: {
      name: 'MRR',
      description: 'Monthly Recurring Revenue',
      unit: 'ë§Œì›',
      targetValue: 500,
      currentValue: 320,
      measurementType: 'MONTHLY',
      category: 'ë§¤ì¶œ',
      businessLineId: anyon.id,
    },
  })

  const anyonActiveUsers = await prisma.kPI.create({
    data: {
      name: 'í™œì„± ì‚¬ìš©ìž',
      description: 'ì›”ê°„ í™œì„± ì‚¬ìš©ìž ìˆ˜',
      unit: 'ëª…',
      targetValue: 1000,
      currentValue: 650,
      measurementType: 'MONTHLY',
      category: 'ì‚¬ìš©ìž',
      businessLineId: anyon.id,
    },
  })

  const anyonChurnRate = await prisma.kPI.create({
    data: {
      name: 'ì´íƒˆë¥ ',
      description: 'ì›”ê°„ êµ¬ë… ì·¨ì†Œìœ¨',
      unit: '%',
      targetValue: 5,
      currentValue: 7.2,
      measurementType: 'MONTHLY',
      category: 'ì‚¬ìš©ìž',
      businessLineId: anyon.id,
    },
  })

  console.log('âœ… KPIs created')

  // Create sample data points (last 30 days)
  const today = new Date()
  for (let i = 30; i >= 0; i--) {
    const date = new Date(today)
    date.setDate(date.getDate() - i)

    // Outsource revenue data points
    await prisma.dataPoint.create({
      data: {
        value: 700 + Math.random() * 100, // 700-800
        timestamp: date,
        source: 'auto',
        kpiId: outsourceRevenue.id,
      },
    })

    // Outsource leads data points
    await prisma.dataPoint.create({
      data: {
        value: 30 + Math.floor(Math.random() * 20), // 30-50
        timestamp: date,
        source: 'auto',
        kpiId: outsourceLeads.id,
      },
    })

    // B2B revenue data points
    await prisma.dataPoint.create({
      data: {
        value: 1100 + Math.random() * 200, // 1100-1300
        timestamp: date,
        source: 'auto',
        kpiId: b2bRevenue.id,
      },
    })

    // ANYON MRR data points
    await prisma.dataPoint.create({
      data: {
        value: 280 + Math.random() * 80, // 280-360
        timestamp: date,
        source: 'auto',
        kpiId: anyonMRR.id,
      },
    })
  }

  console.log('âœ… Data points created (30 days)')

  // Create default dashboard for each business line
  const outsourceDashboard = await prisma.dashboard.create({
    data: {
      name: 'ì™¸ì£¼ ëŒ€ì‹œë³´ë“œ',
      description: 'ì™¸ì£¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¼ì¸ í†µí•© ëŒ€ì‹œë³´ë“œ',
      isDefault: true,
      businessLineId: outsource.id,
      layout: JSON.stringify({
        cols: 12,
        rows: 6,
      }),
    },
  })

  const b2bDashboard = await prisma.dashboard.create({
    data: {
      name: 'B2B ëŒ€ì‹œë³´ë“œ',
      description: 'B2B ë¹„ì¦ˆë‹ˆìŠ¤ ë¼ì¸ í†µí•© ëŒ€ì‹œë³´ë“œ',
      isDefault: true,
      businessLineId: b2b.id,
      layout: JSON.stringify({
        cols: 12,
        rows: 6,
      }),
    },
  })

  const anyonDashboard = await prisma.dashboard.create({
    data: {
      name: 'ANYON ëŒ€ì‹œë³´ë“œ',
      description: 'ANYON B2C í”„ë¡œë•íŠ¸ ëŒ€ì‹œë³´ë“œ',
      isDefault: true,
      businessLineId: anyon.id,
      layout: JSON.stringify({
        cols: 12,
        rows: 6,
      }),
    },
  })

  console.log('âœ… Dashboards created')

  // Create dashboard items for ì™¸ì£¼ dashboard
  await prisma.dashboardItem.create({
    data: {
      type: 'METRIC_CARD',
      title: 'ì›” ë§¤ì¶œ',
      dashboardId: outsourceDashboard.id,
      kpiId: outsourceRevenue.id,
      position: JSON.stringify({ x: 0, y: 0, w: 4, h: 2 }),
      config: JSON.stringify({ showTrend: true, showTarget: true }),
    },
  })

  await prisma.dashboardItem.create({
    data: {
      type: 'METRIC_CARD',
      title: 'ì‹ ê·œ ë¦¬ë“œ',
      dashboardId: outsourceDashboard.id,
      kpiId: outsourceLeads.id,
      position: JSON.stringify({ x: 4, y: 0, w: 4, h: 2 }),
      config: JSON.stringify({ showTrend: true, showTarget: true }),
    },
  })

  await prisma.dashboardItem.create({
    data: {
      type: 'METRIC_CARD',
      title: 'ì „í™˜ìœ¨',
      dashboardId: outsourceDashboard.id,
      kpiId: outsourceConversion.id,
      position: JSON.stringify({ x: 8, y: 0, w: 4, h: 2 }),
      config: JSON.stringify({ showTrend: true, showTarget: true }),
    },
  })

  await prisma.dashboardItem.create({
    data: {
      type: 'LINE_CHART',
      title: 'ë§¤ì¶œ ì¶”ì´',
      dashboardId: outsourceDashboard.id,
      kpiId: outsourceRevenue.id,
      position: JSON.stringify({ x: 0, y: 2, w: 12, h: 4 }),
      config: JSON.stringify({ showTarget: true, period: 30 }),
    },
  })

  console.log('âœ… Dashboard items created')

  console.log('ðŸŽ‰ Seeding completed!')
}

main()
  .catch((e) => {
    console.error('âŒ Seeding failed:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
